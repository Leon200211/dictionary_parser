# Список тегов, маркирующих словарные зоны

## Основные особенности тегов:

1) все теги **парные**: какой бы тег ни использовался, у него всегда есть пара (открытое надо закрывать);

2) не должно быть пробела после открывающего тега, у закрывающего же его не должно быть перед тегом: ...{3} {3}**3.** ТОЛКОВАНИЕ. +6+_ИЛЛЮСТРАЦИЯ_+6+{3} {3}...;

3) пока что, кроме того, соблюдается следующая особенность: внутрь одной пары тегов другие теги могут попадать только тогда, когда вокруг цифры в теге есть плюсы или когда это теги начала/конца статьи (внутри которых все зоны и размечаются): может быть **#...{3}...+6+...+6+{3}...##** и даже **#...{3}...+6+...+6+...+6+...+6+{3}...##**, но не может быть **{3}...{4}{4}...{3}** (в будущем это может измениться, но об этом будет написано отдельно).

## Cписок актуальных тегов:

теги **#** – **##** указывают на начало и конец словарной статьи соответственно;

**{1}** – **{1}** маркируют заголовок (заголовки) словарной статьи; сюда мы включаем также пометы вроде _разг_., _прост_. и пр., которые относятся к вариантному заголовку; союз _и_ перед вариантным заголовком тоже попадает внутрь единиц (...{1}_и_ **ЗАГОЛОВОК**{1});

**{2}** – **{2}** отмечают грамматические пометы и комментарии; как правило, это пометы типа _м_., _ж_., _несов_., _нареч_. и т. д.;

**{3}** – **{3}** выделяют толкования с самой разнообразной информацией, к ним примыкающей; иллюстрации к конкретным значения, оттенки значения, значимые сдвиги внутри одного значения, управление в рамках конкретного значения и нек. др. вещи по умолчанию включаются именно в эту зону;

**{4}** – **{4}** указывают на произношение отдельных звуков;

**{5}** – **{5}** используются для грамматических форм, ударения и (в некоторых случаях) для комментариев к этим формам; часто разница между тегами **{2}** и **{5}** очевидна, однако в некоторых случаях мы принимали (и будем принимать) условные решения; в спорных случаях надо сверяться с инструкцией и дополнениями к ней и опираться на примеры оттуда как на образцы;

**+6+** – **+6+** выделяют информацию, которая в разметке конкретного издания представляется дополнительной, как бы «украшающей» более важную информацию; например, в шестерки включаются иллюстрации к толкованиям (в целом довольно «зонтичные» теги, внутри которых могут быть самые разные сведения о слове);

**{7}** – **{7}** маркируют сведения о словообразовании (здесь могут быть представлены просто однокоренные слова – не обязательно производные или производящие);

**{8}** – **{8}** содержат информацию о предшествующих словарных фиксациях; пока что такие теги используются исключительно в БАС-2;

**+9+** – **+9+** выделяют синонимы;

**+10+** – **+10+** выделяют антонимы;

**{11}** – **{11}** указывают на фразеологию;

**{12}** – **{12}** маркируют отдельно морфемику (без словообразования);

**{13}** – **{13}** включают в себя сведения об этимологии.


**Дополнительно:**

1. теги **6**, **9**, **10**:
    - в основном встречаются как вложенные в другие, т.е.:

      `{3}+6+_ИЛЛЮСТРАЦИЯ_+6+{3}`

    - парсер допускает возможность их появления как самостоятельных, т.е.:

      `{3}текст секции{3}+6+ИЛЛЮСТРАЦИЯ+6+ {4}текст секции{4}`,

      `{3}текст секции{3}{6}ИЛЛЮСТРАЦИЯ{6} {4}текст секции{4}`
2. текст внутри статьи, который не обёрнут в секцию считаем секцией **0**, например:

    ```
        #{1}аа́ленский{1} (от Аа́лен, геол.)##
    ```

    - `аа́ленский` - секция **1**
    - ` (от Аа́лен, геол.)` - секция **0**
3. сами секции также разбираем на составляющие при наличии хотя бы одной вложенной, при этом:
    - текст внутри секции, который не обёрнут во вложенную секцию считаем секцией **0**
    - считаем, что возможен только один уровень вложенности

# Типовые ошибки
- Вложенные друг в друга статьи или отсутствие открывающего или закрывающего символов - _теги **#** – **##**_
- Вложенные друг в друга секции или отсутствие открывающего или закрывающего тегов- _теги **{номер_секции}**_
- Невозможность корректно обработать **секцию 1** - см. `Обычные статьи` > `Обработка секции 1 и примеры результатов работы парсера`

**Все ошибки при парсинге логируем в отдельный файл `errors`, фиксируя пример разметки и указывая тип ошибки (один из вышеперечисленных). Встретив ошибку парсер её логирует и продолжает работу.**

# Ссылочные статьи:
```
ПРИБРА́ТЬ. См.  Прибира́ть.
#ПРИБРА́ТЬСЯ. См.  Прибира́ться##.
```

**На данный момент такие статьи не парсим и пропускаем, но выводим при парсинге в отдельный файл `links`**

# Обычные статьи
## Обработка секции 1 и примеры результатов работы парсера

```
#{1}ааро́новский{1}##
#{1}аа́ленский{1} (от Аа́лен, геол.)##
#{1}ам{1}##
#{1}АМ{1} {3}(сокр.: амплитудная модуляция){3}##
#{1}авто́лизный{1} и {1}ауто́лизный{1}##
#{1}а́льфёльд{1} {3}(геогр.){3} {1}и А́льфёльд{1}, {3}(территория в Венгрии){3}##
#{1}а1{1}, {3}нескл., с. (название буквы){3}##
#{1}а́2{1}, {1}а-а-а{1}, {3}межд.{3}##
#{1}автолизи́рованный{1} {1}и аутолизи́рованный{1}##
#{1}автолизи́ровать(ся){1} {1}и аутолизи́ровать(ся){1}##
#{1}а́бы́ ка́к (како́й, кто́, куда́ и т. п.){1}##
```

### Общее поведение при разборе секции:
1. Секция 1 может встречаться несколько раз - как последовательно так и разделённая другими секциями
2. Слово сохраняем без лишних символов - только буквы и тире
3. В слове заменяем букву `ё` на `е`
4. Написание сохраняем как есть, но все буквы переводим в нижний регистр
5. Для слова с опциональным окончанием (например `автолизи́ровать(ся)`) формируем слово и написание для версии без окончания и с окончанием
6. При сохранении слова и его написания при наличии нескольких значений (помечается числовым верхним индексом - пример `7` и `8`) индекс игнорируем
7. Если при парсинге используется промежуточный html:
    - в контенте секции определяем наличие отрытых, но незакрытых тегов html и закрываем их в конце контента этой секции
    - в контенте секции определяем наличие закрытых, но открытых тегов html и открываем их в начале контента этой секции
    - тег `b` заменяем на `strong`
    - тег `i` заменяем на `em`

### Сохранение данных секций при парсинге

#### Поля секций:
- `type` - номер тега разметки **1-14**, если текст находится вне тегов разметки, то **0**;
- `content` - текстовое содержимое, если у секции нет вложенных секций
- `sections` - массив секций, при наличии вложенных

#### Пример обычной секции:

```
{
    "type": 3,
    "content": "<em>сокр.</em>:амплитудная модуляция)"
}
```
#### Пример секции с вложенными секциями:

```
{
    "type": 3,
    "sections": [
        {
            "type": 0,
            "content": "<strong>2.</strong> Небольшое металлическое колесико ножек мебели, рояля и т. п. для удобства передвижения. "
        },
        {
            "type": 6,
            "content": "Две санитарки с грохотом вкатили в палату высокую тележку на роликах. В. Беляев, Стар. крепость"
        }
    ]
}
```


### Примеры работы парсера:

Исходный файл: [section-1_example.docx](example/section-1_example.docx)

Результат работы парсера: [section-1_example.json](example/section-1_example.json)

1. Единственная **(1)**:

```
[
    {
        "writings": [
            {
                "word": "аароновский",
                "value":"ааро́новский"
            }
        ],
        "sections": [
            {
                "type": 1,
                "content": "<strong>ааро́новский</strong>",
                "sections": []
            }
        ]
    }
]
```
2. Единственная с бессекционным уточнением **(2)**:
```
[
    {
        "writings": [
            {
                "word": "ааленский",
                "value":"аа́ленский"
            }
        ],
        "sections": [
            {
                "type": 1,
                "content": "<strong>аа́ленский</strong>",
                "sections": []
            },
            {
                "type": 0,
                "content": " (<em>от</em> Аа́лен</span>, <em>геол.</em>)",
                "sections": []
            }
        ]
    }
]
```

3. Единственная - две разных статьи с одинаковым написанием, но разным регистром и другими секциями **(3 и 4)**:
```
[
    {
        "writings": [            
            {
                "word": "ам",
                "value":"ам"
            }
        ],
        "sections": [
            {
                "type": 1,
                "content": "<strong>ам</strong>",
                "sections": []
            }
        ]
    },
    {
        "writings": [            
            {
                "word": "ам",
                "value":"ам"
            }
        ],
        "sections": [
            {
                "type": 1,
                "content": "<strong>АМ</strong>",
                "sections": []
            },
            {
                "type": 0,
                "content": " ",
                "sections": []
            },
            {
                "type": 3,
                "content": "<em>сокр.</em>:амплитудная модуляция)",
                "sections": []
            }
        ]
    }
]
```

4. Несколько секций подряд **(5)**:
```
[
    {
        "writings": [            
            {
                "word": "автолизный",
                "value":"авто́лизный"
            }
        ],
        "sections": [
            {
                "type": 1,
                "content": "<strong>авто́лизный</strong>",
                "sections": []
            },
            {
                "type": 0,
                "content": " и ",
                "sections": []
            },
            {
                "type": 3,
                "content": "<strong>ауто́лизный</strong>",
                "sections": []
            }
        ]
    }
]
```
5. Несколько секций разделённые другими **(6)**:
```
[
    {
        "writings": [            
            {
                "word": "альфельд",
                "value":"а́льфёльд"
            }
        ],
        "sections": [
            {
                "type": 1,
                "content": "<strong>а́льфёльд</strong>",
                "sections": []
            },
            {
                "type": 0,
                "content": " ",
                "sections": []
            },
            {
                "type": 3,
                "content": "(<em>геогр.</em>)",
                "sections": []
            },
            {
                "type": 0,
                "content": " и ",
                "sections": []
            },
            {
                "type": 3,
                "content": "<strong>А́льфёльд</strong>",
                "sections": []
            },
            {
                "type": 0,
                "content": ", ",
                "sections": []
            },
            {
                "type": 3,
                "content": "(<em>территория в Венгрии</em>)",
                "sections": []
            }
        ]
    }
]
```
6. Два разных значения у слова в одном словаре **(7 и 8)**:
```
[
    {
        "writings": [            
            {
                "word": "а",
                "value":"а"
            }
        ],
        "sections": [
            {
                "type": 1,
                "content": "<strong>а<sup>1</sup></strong>",
                "sections": []
            },
            {
                "type": 0,
                "content": ", ",
                "sections": []
            },
            {
                "type": 3,
                "content": "<em>нескл</em>., <em>с</em>. (<em>название буквы</em>)",
                "sections": []
            }
        ]
    },
    {
        "writings": [            
            {
                "word": "а",
                "value":"а́"
            },                        
            {
                "word": "а-а-а",
                "value":"а-а-а"
            }
        ],
        "sections": [
            {
                "type": 1,
                "content": "<strong>а́<sup>2</sup></strong>",
                "sections": []
            },
            {
                "type": 0,
                "content": ", ",
                "sections": []
            },
            {
                "type": 1,
                "content": "<strong>а-а-а</strong>",
                "sections": []
            },
            {
                "type": 0,
                "content": ", ",
                "sections": []
            },
            {
                "type": 3,
                "content": "<em>межд</em>.",
                "sections": []
            }
        ]
    }
]
```
7. Две секции подряд, но присутствуют лишние символы в секции **(9)**:
```
[
    {
        "writings": [            
            {
                "word": "автолизированный",
                "value":"автолизи́рованный"
            },                        
            {
                "word": "аутолизированный",
                "value":"аутолизи́рованный"
            }
        ],
        "sections": [
            {
                "type": 1,
                "content": "<strong>автолизи́рованный</strong>",
                "sections": []
            },
            {
                "type": 0,
                "content": " и ",
                "sections": []
            },
            {
                "type": 1,
                "content": "<strong>автолизи́рованный</strong>",
                "sections": []
            }
        ]
    }
]
```
8. Слова с опциональным окончанием **(10)**:
```
[
    {
        "writings": [            
            {
                "word": "автолизировать",
                "value":"автолизи́ровать"
            },                        
            {
                "word": "автолизироваться",
                "value":"автолизи́роваться"
            },
            {
                "word": "аутолизировать",
                "value":"аутолизи́ровать"
            },                        
            {
                "word": "аутолизироваться",
                "value":"аутолизи́роваться"
            }
        ],
        "sections": [
            {
                "type": 1,
                "content": "<strong>автолизи́ровать(ся)</strong>",
                "sections": []
            },
            {
                "type": 0,
                "content": " и ",
                "sections": []
            },
            {
                "type": 1,
                "content": "<strong>аутолизи́ровать(ся)</strong>",
                "sections": []
            }
        ]
    }
]
```
9. Ситуации требующие вмешательства:
   Записываем в лог

## Пример парсинга статьи с комбинированными секциями

```
#{1}РО́ЛИК{1}, {5}ро́лика{5}, {2}м.{2} {3}1. Вращающаяся часть какого-л. механизма в виде небольшого цилиндра, вала, катушки. +6+Из печи с глухим стуком поочередно выпадают раскаленные пластины стали; массивные, быстро вращающиеся ролики влекут их к прокатным устройствам. Бек, Тимофей Открыт. сердце+6+{3}.
{3}2. Небольшое металлическое колесико ножек мебели, рояля и т. п. для удобства передвижения. +6+Две санитарки с грохотом вкатили в палату высокую тележку на роликах. В. Беляев, Стар. крепость+6+{3}.
{3}3. Только мн. Коньки на колесиках. +6+Толпа собралась перед лавкой — женщины с кошелками, трое мальчишек на роликах, велосипедист. Федин, Похищ. Европы. Мадмуазель Мартен быстро пошла к Бибиковскому бульвару своей скользящей походкой, будто она бежала короткими шагами на роликах. Паустов. Далек. годы+6+{3}.
{3}4. Фарфоровый изолятор в виде катушки для укрепления на нем электрических проводов. +6+Небо было затянуто серым туманом, в темноте переулка неясно белел киоск на углу и ролики подвешенных антенн. Кетлинская, Дни нашей жизни. — Приезжаем на склад электрооборудования: дайте роликов, проводов, двигателей вне очереди для отстающего колхоза! Николаева, Жатва+6+{3}.
{3}5. Катушка с кинопленкой. +6+Советская негативная пленка только осваивалась. В те времена она не имела стандартной эмульсии — все куски были разные. Упаковывалась пленка в мелкие ролики, не превышавшие в лучшем случае семьдесят-восемьдесят метров. Кулеш. и Хохлова, 50 лет в кино. // Часть кинофильма, помещающаяся на такой катушке. Мы показывали фильмы, которые привезли с собой. Я три ролика из картины «Жуковский», Черкасов — целую серию роликов, характеризующих его творческий путь. Пудов. Поездка в Индию. За долгие часы озвучания, повторяя ролик за роликом слова другого актера, чувствуешь себя как бы его частицей. Гиацинтова, Верность истокам. // Короткометражный кино- или телефильм. ◊ Рекламный ро́лик. Делать рекламу учат. Есть специальные заведения, где изучается психология спроса, совершенствуется режиссура изготовления рекламных роликов. Они делаются с большей тщательностью, чем художественные фильмы. Песков и Стрельников, Земля за океаном. Закончился рекламный ролик. В зале стоял приятный гул одобрения. Л. Гурченко, Аплодисменты+6+{3}.
+6+Шарики за ро́лики закатились, заскочили, зашли и т. п. См. Ша́рик+6+.
{8}— Ушаков, 1939: ро́лик{8}##.
```

[nested_sections_example.docx](example/nested_sections_example.docx)

[nested_sections_example.json](example/nested_sections_example.json)


**Возможный промежуточный html**:
```
<p>#{1}РО́ЛИК{1}, {5}ро́лика{5}, {2}м.{2} {3}1. Вращающаяся часть какого-л. механизма в виде небольшого цилиндра, вала,
    катушки. +6+Из печи с глухим стуком поочередно выпадают раскаленные пластины стали; массивные, быстро вращающиеся
    ролики влекут их к прокатным устройствам. Бек, Тимофей Открыт. сердце+6+{3}.</p>
<p>{3}<strong>2.</strong> Небольшое металлическое колесико ножек мебели, рояля и т. п. для удобства передвижения. +6+Две
    санитарки с грохотом вкатили в палату высокую тележку на роликах. В. Беляев, Стар. крепость+6+{3}.</p>
<p>{3}<strong>3.</strong><em> Только мн.</em> Коньки на колесиках. +6+<em>Толпа собралась перед лавкой — женщины с
        кошелками, трое мальчишек на роликах, велосипедист.</em> Федин, Похищ. Европы. <em>Мадмуазель Мартен быстро
        пошла к Бибиковскому бульвару своей скользящей походкой, будто она бежала короткими шагами на роликах.</em>
    Паустов. Далек. годы+6+{3}.</p>
<p>{3}<strong>4.</strong> Фарфоровый изолятор в виде катушки для укрепления на нем электрических проводов. +6+<em>Небо
        было затянуто серым туманом, в темноте переулка неясно белел киоск на углу и ролики подвешенных антенн.</em>
    Кетлинская, Дни нашей жизни.<em> — Приезжаем на склад электрооборудования: дайте роликов, проводов, двигателей вне
        очереди для отстающего колхоза! </em>Николаева, Жатва+6+{3}.</p>
<p>{3}<strong>5.</strong> Катушка с кинопленкой. +6+<em>Советская негативная пленка только осваивалась. В те времена она
        не имела стандартной эмульсии — все куски были разные. Упаковывалась пленка в мелкие ролики, не превышавшие в
        лучшем случае семьдесят-восемьдесят метров.</em> Кулеш. и Хохлова, 50 лет в кино. // Часть кинофильма,
    помещающаяся на такой катушке. <em>Мы показывали фильмы, которые привезли с собой. Я три ролика из картины
        «Жуковский», Черкасов — целую серию роликов, характеризующих его творческий путь.</em> Пудов. Поездка в Индию.
    <em>За долгие часы озвучания, повторяя ролик за роликом слова другого актера, чувствуешь себя как бы его
        частицей.</em> Гиацинтова, Верность истокам. // Короткометражный кино- или телефильм. ◊ Рекламный ро́лик.
    <em>Делать рекламу учат. Есть специальные заведения, где изучается психология спроса, совершенствуется режиссура
        изготовления рекламных роликов. Они делаются с большей тщательностью, чем художественные фильмы.</em> Песков и
    Стрельников, Земля за океаном. <em>Закончился рекламный ролик. В зале стоял приятный гул одобрения.</em> Л.
    Гурченко, Аплодисменты+6+{3}.</p>
<p>+6+<strong><em>Шарики</em></strong><em> </em><strong><em>за</em></strong><em>
    </em><strong><em>ро́лики</em></strong><em> </em><strong><em>закатились</em>,</strong>
    <strong><em>заскочили</em>,</strong> <strong><em>зашли</em></strong> и т. п. См. Ша́рик+6+.</p>
<p>{8}— Ушаков<strong>, 1939: ро́лик</strong>{8}<strong>##.</strong></p>
```

**Ожидаемый результат парсинга:**
```
[
    {
        "writings": [
            {
                "word": "ролик",
                "value": "ро́лик"
            }
        ],
        "sections": [
            {
                "type": 1,
                "content": "РО́ЛИК"
            },
            {
                "type": 0,
                "content": ", "
            },
            {
                "type": 5,
                "content": "ро́лика"
            },
            {
                "type": 0,
                "content": ", "
            },
            {
                "type": 2,
                "content": "м."
            },
            {
                "type": 0,
                "content": " "
            },
            {
                "type": 3,
                "sections": [
                    {
                        "type": 0,
                        "content": "1. Вращающаяся часть какого-л. механизма в виде небольшого цилиндра, вала, катушки. "
                    },
                    {
                        "type": 6,
                        "content": "Из печи с глухим стуком поочередно выпадают раскаленные пластины стали; массивные, быстро вращающиеся ролики влекут их к прокатным устройствам. Бек, Тимофей Открыт. сердце"
                    }
                ]
            },
            {
                "type": 0,
                "content": "."
            },
            {
                "type": 3,
                "sections": [
                    {
                        "type": 0,
                        "content": "<strong>2.</strong> Небольшое металлическое колесико ножек мебели, рояля и т. п. для удобства передвижения. "
                    },
                    {
                        "type": 6,
                        "content": "Две санитарки с грохотом вкатили в палату высокую тележку на роликах. В. Беляев, Стар. крепость"
                    }
                ]
            },
            {
                "type": 0,
                "content": "."
            },
            {
                "type": 3,
                "sections": [
                    {
                        "type": 0,
                        "content": "<strong>3.</strong><em> Только мн.</em> Коньки на колесиках. "
                    },
                    {
                        "type": 6,
                        "content": "<em>Толпа собралась перед лавкой — женщины с кошелками, трое мальчишек на роликах, велосипедист.</em> Федин, Похищ. Европы. <em>Мадмуазель Мартен быстро пошла к Бибиковскому бульвару своей скользящей походкой, будто она бежала короткими шагами на роликах.</em> Паустов. Далек. годы"
                    }
                ]
            },
            {
                "type": 0,
                "content": "."
            },
            {
                "type": 3,
                "sections": [
                    {
                        "type": 0,
                        "content": "<strong>4.</strong> Фарфоровый изолятор в виде катушки для укрепления на нем электрических проводов. "
                    },
                    {
                        "type": 6,
                        "content": "<em>Небо было затянуто серым туманом, в темноте переулка неясно белел киоск на углу и ролики подвешенных антенн.</em> Кетлинская, Дни нашей жизни.<em> — Приезжаем на склад электрооборудования: дайте роликов, проводов, двигателей вне очереди для отстающего колхоза! </em>Николаева, Жатва"
                    }
                ]
            },
            {
                "type": 0,
                "content": "."
            },
            {
                "type": 3,
                "sections": [
                    {
                        "type": 0,
                        "content": "<strong>5.</strong> Катушка с кинопленкой. "
                    },
                    {
                        "type": 6,
                        "content": "<em>Советская негативная пленка только осваивалась. В те времена она не имела стандартной эмульсии — все куски были разные. Упаковывалась пленка в мелкие ролики, не превышавшие в лучшем случае семьдесят-восемьдесят метров.</em> Кулеш. и Хохлова, 50 лет в кино. // Часть кинофильма, помещающаяся на такой катушке. <em>Мы показывали фильмы, которые привезли с собой. Я три ролика из картины «Жуковский», Черкасов — целую серию роликов, характеризующих его творческий путь.</em> Пудов. Поездка в Индию. <em>За долгие часы озвучания, повторяя ролик за роликом слова другого актера, чувствуешь себя как бы его частицей.<em> Гиацинтова, Верность истокам. // Короткометражный кино- или телефильм. ◊ Рекламный ро́лик. <em>Делать рекламу учат. Есть специальные заведения, где изучается психология спроса, совершенствуется режиссура изготовления рекламных роликов. Они делаются с большей тщательностью, чем художественные фильмы.</em> Песков и Стрельников, Земля за океаном. <em>Закончился рекламный ролик. В зале стоял приятный гул одобрения.<em> Л. Гурченко, Аплодисменты"
                    }
                ]
            },
            {
                "type": 0,
                "content": "."
            },
            {
                "type": 6,
                "content": "<strong><em>Шарики</em></strong><em> </em><strong><em>за</em></strong><em> </em><strong><em>ро́лики</em></strong><em> </em><strong><em>закатились</em>,</strong> <strong><em>заскочили</em>,</strong> <strong><em>зашли</em></strong> и т. п. См. Ша́рик"
            },
            {
                "type": 0,
                "content": "."
            },
            {
                "type": 0,
                "content": "— Ушаков<strong>, 1939: ро́лик</strong>"
            }
        ]
    }
]
```


